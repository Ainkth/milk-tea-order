<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>你想喝什么奶茶</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2920/2920331.png" type="image/png">
<style>
body{font-family:Arial,sans-serif;margin:50px;background:#f0f0f0}
h2{text-align:center}
.container{max-width:500px;margin:auto;background:white;padding:20px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
select,input,textarea{width:100%;padding:8px;margin:6px 0;box-sizing:border-box;border-radius:4px;border:1px solid #ccc;font-size:14px}
button{padding:10px 20px;font-size:16px;border:none;border-radius:4px;background:#FF7043;color:white;cursor:pointer}
button:hover{background:#FF5722}
label span{color:red}
.feedback{margin-top:10px;font-weight:bold;position:relative;}
.feedback.success{color:green;}
.feedback.error{color:red;}
input.error, select.error { border-color: red; animation: shake 0.3s; }
@keyframes shake {0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }}
.feedback.slide-down { animation: slideDown 0.5s ease forwards; }
@keyframes slideDown { 0% { opacity: 0; transform: translateY(-20px); } 100% { opacity: 1; transform: translateY(0); } }
.feedback.fadeout { opacity: 1; transition: opacity 2s ease; }
.feedback.fadeout.hide { opacity: 0; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<div class="container">
<h2>奶茶订单收集</h2>

<label for="shop">选择奶茶店：<span>*</span></label>
<select id="shop">
  <option value="">--请选择--</option>
  <option value="霸王茶姬">霸王茶姬</option>
  <option value="茶颜悦色">茶颜悦色</option>
  <option value="一点点">一点点</option>
  <option value="爷爷不泡茶">爷爷不泡茶</option>
  <option value="喜茶">喜茶</option>
  <option value="茉莉奶白">茉莉奶白</option>
  <option value="瑞幸">瑞幸</option>
  <option value="茶百道">茶百道</option>
  <option value="泰大杯">泰大杯</option>
  <option value="其他">其他（请私信Zhq）</option>
</select>

<label for="drink">你想喝的奶茶：<span>*</span></label>
<input type="text" id="drink" placeholder="输入奶茶名称">

<label for="ice">冰度：<span>*</span></label>
<select id="iceSelect">
  <option value="">请选择冰度</option>
  <option value="正常冰">正常冰</option>
  <option value="少冰">少冰</option>
  <option value="微冰">微冰</option>
  <option value="去冰">去冰</option>
  <option value="热饮">热饮</option>
  <option value="其他">其他</option>
</select>
<input type="text" id="iceOther" placeholder="请输入冰度" style="display:none">

<label for="sugar">糖度：<span>*</span></label>
<select id="sugarSelect">
  <option value="">请选择糖度</option>
  <option value="全糖">全糖</option>
  <option value="七分糖">七分糖</option>
  <option value="半糖">半糖</option>
  <option value="三分糖">三分糖</option>
  <option value="无糖">无糖</option>
  <option value="其他">其他</option>
</select>
<input type="text" id="sugarOther" placeholder="请输入糖度" style="display:none">

<label for="note">备注：</label>
<input type="text" id="note" placeholder="加料或口味要求">

<button id="submitBtn">提交</button>
<div id="feedback" class="feedback"></div>
</div>

<script>
// 初始化 Supabase，使用 client 避免 window.supabase 报错
const client = supabase.createClient(
  "https://pgcqmgpenpntkagdgxzj.supabase.co",
  "sb_publishable_rGawkinb8jxvxYOFl1F-ZA_0oGnhju2"
);

// 冰度/糖度“其他”切换
document.getElementById("iceSelect").onchange = toggleIceOther;
document.getElementById("sugarSelect").onchange = toggleSugarOther;

function toggleIceOther(){
  const select = document.getElementById("iceSelect");
  const other = document.getElementById("iceOther");
  other.style.display = (select.value==="其他")?"block":"none";
  if(select.value==="其他") other.focus(); else other.value="";
}

function toggleSugarOther(){
  const select = document.getElementById("sugarSelect");
  const other = document.getElementById("sugarOther");
  other.style.display = (select.value==="其他")?"block":"none";
  if(select.value==="其他") other.focus(); else other.value="";
}

// 显示提示
function showFeedback(msg,isSuccess){
    const feedback = document.getElementById("feedback");
    feedback.textContent = msg;
    feedback.className = "feedback "+(isSuccess?"success slide-down":"error");
    if(isSuccess){
        setTimeout(()=>{feedback.classList.add("fadeout","hide")},1500);
        setTimeout(()=>{feedback.textContent="";feedback.className="feedback";},3000);
    }
}

// 表单错误动画
function setError(el,msg){
    el.classList.add("error");
    setTimeout(()=>el.classList.remove("error"),500);
    showFeedback(msg,false);
}

// 提交表单
document.getElementById("submitBtn").onclick = async function(){
    const shop = document.getElementById("shop").value;
    const drink = document.getElementById("drink").value.trim();
    let ice = document.getElementById("iceSelect").value;
    if(ice==="其他") ice=document.getElementById("iceOther").value.trim();
    let sugar = document.getElementById("sugarSelect").value;
    if(sugar==="其他") sugar=document.getElementById("sugarOther").value.trim();
    const note = document.getElementById("note").value.trim();

    // 表单验证
    if(!shop){showFeedback("请选择奶茶店",false);return;}
    if(!drink){showFeedback("请输入奶茶名称",false);return;}
    if(drink.length>50){showFeedback("奶茶名称不能超过50字",false);return;}
    if(!ice){showFeedback("请选择或填写冰度",false);return;}
    if(!sugar){showFeedback("请选择或填写糖度",false);return;}

    // 使用 client 插入数据
    const {data, error} = await client
        .from("submissions")
        .insert([{nickname:shop, content:drink, ice:ice, sugar:sugar, note:note}]);

    if(error) showFeedback("提交失败："+error.message,false);
    else{
        showFeedback("提交成功！",true);
        document.getElementById("shop").value="";
        document.getElementById("drink").value="";
        document.getElementById("iceSelect").value="";
        document.getElementById("iceOther").value="";
        document.getElementById("sugarSelect").value="";
        document.getElementById("sugarOther").value="";
        document.getElementById("note").value="";
    }
}
</script>
</body>
</html>
