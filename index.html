<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>你想喝什么奶茶</title>
<style>
body{font-family:Arial,sans-serif;margin:50px;background:#f0f0f0}
h2{text-align:center}
.container{max-width:500px;margin:auto;background:white;padding:20px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
select,input,textarea{width:100%;padding:8px;margin:6px 0;box-sizing:border-box;border-radius:4px;border:1px solid #ccc;font-size:14px}
button{padding:10px 20px;font-size:16px;border:none;border-radius:4px;background:#FF7043;color:white;cursor:pointer}
button:hover{background:#FF5722}
label span{color:red}
.feedback{margin-top:10px;font-weight:bold;}
.feedback.success{color:green;}
.feedback.error{color:red;}

input.error, select.error {
  border-color: red;
  animation: shake 0.3s;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}

.feedback.fadeout {
  opacity: 1;
  transition: opacity 2s ease;
}
.feedback.fadeout.hide {
  opacity: 0;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<div class="container">
<h2>奶茶订单收集</h2>

<label for="shop">选择奶茶店：<span>*</span></label>
<select id="shop">
  <option value="">--请选择--</option>
  <option value="霸王茶姬">霸王茶姬</option>
  <option value="茶颜悦色">茶颜悦色</option>
  <option value="一点点">一点点</option>
  <option value="爷爷不泡茶">爷爷不泡茶</option>
  <option value="喜茶">喜茶</option>
  <option value="茉莉奶白">茉莉奶白</option>
  <option value="瑞幸">瑞幸</option>
  <option value="茶百道">茶百道</option>
  <option value="泰大杯">泰大杯</option>
  <option value="其他">其他（请私信Zhq）</option>
</select>

<label for="drink">你想喝的奶茶：<span>*</span></label>
<input type="text" id="drink" placeholder="输入奶茶名称">

<label for="ice">冰度：<span>*</span></label>
<select id="iceSelect" onchange="toggleIceOther()">
  <option value="">请选择冰度</option>
  <option value="正常冰">正常冰</option>
  <option value="少冰">少冰</option>
  <option value="微冰">微冰</option>
  <option value="去冰">去冰</option>
  <option value="热饮">热饮</option>
  <option value="其他">其他</option>
</select>
<input type="text" id="iceOther" placeholder="请输入冰度" style="display:none">

<label for="sugar">糖度：<span>*</span></label>
<select id="sugarSelect" onchange="toggleSugarOther()">
  <option value="">请选择糖度</option>
  <option value="全糖">全糖</option>
  <option value="七分糖">七分糖</option>
  <option value="半糖">半糖</option>
  <option value="三分糖">三分糖</option>
  <option value="无糖">无糖</option>
  <option value="其他">其他</option>
</select>
<input type="text" id="sugarOther" placeholder="请输入糖度" style="display:none">

<label for="note">备注：</label>
<input type="text" id="note" placeholder="加料或口味要求">

<button id="submitBtn">提交</button>
<div id="feedback" class="feedback"></div>
</div>

<script>
const supabaseUrl="https://pgcqmgpenpntkagdgxzj.supabase.co"
const supabaseKey="sb_publishable_rGawkinb8jxvxYOFl1F-ZA_0oGnhju2"
const supabase=supabase.createClient(supabaseUrl,supabaseKey)

function toggleIceOther(){
  const select=document.getElementById("iceSelect")
  const other=document.getElementById("iceOther")
  if(select.value==="其他"){
      other.style.display="block"
      other.focus()  // 自动聚焦
  } else {
      other.style.display="none"
      other.value=""
  }
}

function toggleSugarOther(){
  const select=document.getElementById("sugarSelect")
  const other=document.getElementById("sugarOther")
  if(select.value==="其他"){
      other.style.display="block"
      other.focus()  // 自动聚焦
  } else {
      other.style.display="none"
      other.value=""
  }
}

function showFeedback(msg,isSuccess){
    const feedback=document.getElementById("feedback")
    feedback.textContent=msg
    feedback.className="feedback "+(isSuccess?"success fadeout":"error")
    
    if(isSuccess){
        // 0.5秒后开始淡出
        setTimeout(()=>{feedback.classList.add("hide")},500)
        // 3秒后清空
        setTimeout(()=>{
            feedback.textContent=""
            feedback.classList.remove("fadeout","hide")
        },3000)
    }
}

function setError(el,msg){
    el.classList.add("error")
    setTimeout(()=>el.classList.remove("error"),500)
    showFeedback(msg,false)
}

document.getElementById("submitBtn").onclick=async function(){
    const shop=document.getElementById("shop")
    const drink=document.getElementById("drink")
    const iceSelect=document.getElementById("iceSelect")
    const iceOther=document.getElementById("iceOther")
    const sugarSelect=document.getElementById("sugarSelect")
    const sugarOther=document.getElementById("sugarOther")
    const note=document.getElementById("note")

    let ice=iceSelect.value
    if(ice==="其他") ice=iceOther.value.trim()

    let sugar=sugarSelect.value
    if(sugar==="其他") sugar=sugarOther.value.trim()

    if(!shop.value){setError(shop,"请选择奶茶店");return;}
    if(!drink.value.trim()){setError(drink,"请输入奶茶名称");return;}
    if(drink.value.trim().length>50){setError(drink,"奶茶名称不能超过50字");return;}
    if(!ice){setError(iceSelect,"请选择或填写冰度");return;}
    if(ice.length>20){setError(iceSelect,"冰度不能超过20字");return;}
    if(!sugar){setError(sugarSelect,"请选择或填写糖度");return;}
    if(sugar.length>20){setError(sugarSelect,"糖度不能超过20字");return;}

    const {error}=await supabase.from("submissions").insert([{
        nickname:shop.value,
        content:drink.value.trim(),
        ice:ice,
        sugar:sugar,
        note:note.value.trim()
    }])

    if(error){
        showFeedback("提交失败："+error.message,false)
    }else{
        showFeedback("提交成功！",true)
        shop.value=""
        drink.value=""
        iceSelect.value=""
        iceOther.value=""
        sugarSelect.value=""
        sugarOther.value=""
        note.value=""
    }
}
</script>
</body>
</html>
